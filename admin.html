<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Gestionar Productos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        .font-display { font-family: 'Playfair Display', serif; }
        .font-body { font-family: 'Poppins', sans-serif; }
        .notification { transition: transform 0.3s ease-in-out; }
        .image-preview-item { position: relative; }
        .image-preview-item .remove-btn {
            position: absolute; top: -5px; right: -5px; background-color: #ef4444; color: white;
            border-radius: 9999px; width: 20px; height: 20px; display: flex;
            align-items: center; justify-content: center; cursor: pointer; font-weight: bold;
            border: none; line-height: 1; font-size: 14px;
        }
        input[type="text"]:read-only, textarea:read-only { 
            background-color: #f3f4f6; 
            cursor: not-allowed; 
        }
        input[type="checkbox"] {
            cursor: pointer;
        }
        
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none; 
          margin: 0; 
        }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body class="bg-gray-100 font-body">

    <div id="notification-container" class="fixed top-5 right-5 z-50"></div>

    <div class="container mx-auto p-8">
        <h1 class="font-display text-4xl font-bold text-gray-800 mb-4">Panel de Administración</h1>

        <div class="mb-8 border-b border-gray-200">
            <nav class="flex space-x-8" aria-label="Tabs">
                <span class="font-bold text-pink-600 border-b-2 border-pink-600 px-1 pb-4 text-sm">Gestionar Productos</span>
                <a href="admin-orders.html" class="text-gray-500 hover:text-gray-700 hover:border-gray-300 px-1 pb-4 text-sm">Ver Pedidos</a>
            </nav>
        </div>

        <div id="view-products">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- COLUMNA DEL FORMULARIO -->
                <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-md h-fit">
                    <h2 id="form-title" class="font-display text-2xl font-bold text-gray-700 mb-6">Añadir Nuevo Producto</h2>
                    <form id="product-form" class="space-y-6">
                        <input type="hidden" id="productId">
                        
                        <fieldset class="space-y-4">
                            <legend class="font-bold text-lg mb-2">Información Básica</legend>
                            <div>
                                <label for="name" class="block text-sm font-medium text-gray-700">Nombre del Producto</label>
                                <input type="text" id="name" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-pink-500 focus:border-pink-500">
                            </div>
                            <div>
                                <label for="short_description" class="block text-sm font-medium text-gray-700">Descripción Corta</label>
                                <input type="text" id="short_description" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" placeholder="Para listas y vistas previas">
                            </div>
                            <div>
                                <label for="long_description" class="block text-sm font-medium text-gray-700">Descripción Larga</label>
                                <textarea id="long_description" rows="5" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" placeholder="Para la página de detalle del producto"></textarea>
                            </div>
                            <div>
                                <label for="category" class="block text-sm font-medium text-gray-700">Categorías</label>
                                <input type="text" id="category" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" placeholder="Hogar, Velas, Decoración...">
                                <p class="text-xs text-gray-500 mt-1">Separa las categorías por comas.</p>
                            </div>
                        </fieldset>

                        <fieldset class="space-y-4 border-t pt-6">
                            <legend class="font-bold text-lg mb-2">Precios y Costos</legend>
                             <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="base_price" class="block text-sm font-medium">Precio Base</label>
                                    <input type="number" id="base_price" step="0.01" class="mt-1 block w-full rounded-md" placeholder="2500.00">
                                </div>
                                <div>
                                    <label for="sale_price" class="block text-sm font-medium">Precio de Oferta</label>
                                    <input type="number" id="sale_price" step="0.01" class="mt-1 block w-full rounded-md" placeholder="1999.99">
                                </div>
                                 <div>
                                    <label for="cost_price" class="block text-sm font-medium">Costo (Interno)</label>
                                    <input type="number" id="cost_price" step="0.01" class="mt-1 block w-full rounded-md" placeholder="1200.00">
                                </div>
                                 <div>
                                    <label for="taxes" class="block text-sm font-medium">Impuestos (%)</label>
                                    <input type="number" id="taxes" value="21" class="mt-1 block w-full rounded-md" placeholder="21">
                                </div>
                             </div>
                             <div class="grid grid-cols-2 gap-4">
                                <div class="p-2 bg-gray-50 rounded">
                                    <label for="discount_percentage" class="block text-xs font-medium">Descuento (%)</label>
                                    <input type="text" id="discount_percentage" readonly class="mt-1 block w-full rounded-md border-0 bg-gray-50 font-bold text-gray-600">
                                </div>
                                <div class="p-2 bg-pink-50 rounded">
                                    <label for="final_price" class="block text-xs font-medium text-pink-800">Precio Final (PVP)</label>
                                    <input type="text" id="final_price" readonly class="mt-1 block w-full rounded-md border-0 bg-pink-50 font-bold text-pink-700">
                                </div>
                            </div>
                        </fieldset>

                        <fieldset class="space-y-4 border-t pt-6">
                            <legend class="font-bold text-lg mb-2">Inventario y Logística</legend>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="stock" class="block text-sm font-medium">Stock</label>
                                    <input type="number" id="stock" value="0" class="mt-1 block w-full rounded-md">
                                </div>
                                <div>
                                    <label for="status" class="block text-sm font-medium">Estado</label>
                                    <select id="status" class="mt-1 block w-full rounded-md">
                                        <option value="activo">Activo</option>
                                        <option value="inactivo">Inactivo</option>
                                        <option value="agotado">Agotado</option>
                                    </select>
                                </div>
                                 <div>
                                    <label for="min_purchase_quantity" class="block text-sm font-medium">Compra Mín.</label>
                                    <input type="number" id="min_purchase_quantity" value="1" class="mt-1 block w-full rounded-md">
                                </div>
                                 <div>
                                    <label for="max_purchase_quantity" class="block text-sm font-medium">Compra Máx.</label>
                                    <input type="number" id="max_purchase_quantity" class="mt-1 block w-full rounded-md">
                                </div>
                                <div>
                                    <label for="weight" class="block text-sm font-medium">Peso (kg)</label>
                                    <input type="number" id="weight" step="0.01" class="mt-1 block w-full rounded-md" placeholder="0.5">
                                </div>
                                <div>
                                    <label for="restock_time" class="block text-sm font-medium">Reposición (días)</label>
                                    <input type="number" id="restock_time" class="mt-1 block w-full rounded-md" placeholder="7">
                                </div>
                            </div>
                            <div>
                                <label for="dimensions" class="block text-sm font-medium">Dimensiones (cm)</label>
                                <input type="text" id="dimensions" class="mt-1 block w-full rounded-md" placeholder="10x15x8">
                            </div>
                        </fieldset>

                        <fieldset class="space-y-4 border-t pt-6">
                            <legend class="font-bold text-lg mb-2">Producción</legend>
                             <div class="flex items-center">
                                <input type="checkbox" id="has_production_time" class="h-4 w-4 text-pink-600 rounded">
                                <label for="has_production_time" class="ml-2 block text-sm font-medium">Este producto se hace bajo pedido</label>
                            </div>
                            <div id="production-time-container" class="hidden">
                                <label for="production_time_hours" class="block text-sm font-medium">Tiempo de Producción (horas)</label>
                                <input type="number" id="production_time_hours" class="mt-1 block w-full rounded-md" placeholder="48">
                            </div>
                        </fieldset>

                        <fieldset class="space-y-4 border-t pt-6">
                            <legend class="font-bold text-lg mb-2">Multimedia y Visibilidad</legend>
                             <div>
                                <label for="video_url" class="block text-sm font-medium">URL del Video (Opcional)</label>
                                <input type="text" id="video_url" class="mt-1 block w-full rounded-md" placeholder="https://www.youtube.com/watch?v=...">
                            </div>
                            <div>
                                 <label class="block text-sm font-medium mb-2">Imágenes</label>
                                 <div class="p-4 border-2 border-dashed rounded-md">
                                    <input type="file" id="image-files" multiple accept="image/*" class="block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:font-semibold file:bg-pink-50 file:text-pink-700 hover:file:bg-pink-100">
                                    <div id="image-preview" class="mt-4 flex flex-wrap gap-4"></div>
                                 </div>
                                 <input type="hidden" id="image-urls">
                            </div>
                            <div class="grid grid-cols-2 gap-4 pt-2">
                                <div class="flex items-center">
                                    <input type="checkbox" id="enabled" class="h-4 w-4 text-pink-600 rounded">
                                    <label for="enabled" class="ml-2 block text-sm font-medium">Habilitado en tienda</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="featured" class="h-4 w-4 text-pink-600 rounded">
                                    <label for="featured" class="ml-2 block text-sm font-medium">Destacado</label>
                                </div>
                                 <div class="flex items-center">
                                    <input type="checkbox" id="customizable" class="h-4 w-4 text-pink-600 rounded">
                                    <label for="customizable" class="ml-2 block text-sm font-medium">Personalizable</label>
                                </div>
                            </div>
                        </fieldset>

                        <div class="flex gap-4 pt-6 border-t">
                            <button type="submit" class="w-full bg-pink-500 text-white font-bold py-2 px-4 rounded-full hover:bg-pink-600">Guardar Producto</button>
                            <button type="button" id="cancel-edit-btn" class="w-full bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-full hover:bg-gray-300">Cancelar</button>
                        </div>
                    </form>
                </div>
                <!-- COLUMNA DE LISTA DE PRODUCTOS -->
                <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="font-display text-2xl font-bold text-gray-700">Productos Actuales</h2>
                        <button id="refresh-products-btn" class="p-2 text-gray-500 hover:bg-gray-100 rounded-full" aria-label="Actualizar lista de productos">
                            <i data-lucide="refresh-cw" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <ul id="product-list" class="space-y-4"></ul>
                </div>
            </div>
        </div>

    </div>

    <script src="https://unpkg.com/lucide@latest" defer></script>
    <script>
        const adminApp = {
            apiBaseUrl: 'http://localhost:3000',
            products: [],
            imagesToUpload: [],

            init() {
                this.addEventListeners();
                this.loadProducts();
            },

            addEventListeners() {
                document.getElementById('product-form').addEventListener('submit', this.handleFormSubmit.bind(this));
                document.getElementById('cancel-edit-btn').addEventListener('click', () => this.resetForm());
                document.getElementById('product-list').addEventListener('click', this.handleProductListClick.bind(this));
                document.getElementById('image-files').addEventListener('change', this.handleImagePreview.bind(this));
                document.getElementById('refresh-products-btn').addEventListener('click', () => this.loadProducts());
                
                ['base_price', 'sale_price', 'taxes'].forEach(id => {
                    document.getElementById(id).addEventListener('input', this.updateCalculatedPrices);
                });
                document.getElementById('has_production_time').addEventListener('change', (e) => {
                    document.getElementById('production-time-container').classList.toggle('hidden', !e.target.checked);
                });
            },
            
            async loadProducts() {
                try {
                    const response = await fetch(`${this.apiBaseUrl}/api/products?all=true`, { 
                        headers: { 'x-admin-secret': 'tu-clave-secreta-aqui' } 
                    });

                    if (!response.ok) {
                         const errorData = await response.json();
                         throw new Error(errorData.error || `Error del servidor: ${response.status}`);
                    }
                    this.products = await response.json();
                    
                    const listContainer = document.getElementById('product-list');
                    listContainer.innerHTML = ''; 
                    if (!this.products.length) { 
                        listContainer.innerHTML = '<li><p>No hay productos para mostrar.</p></li>';
                        return;
                    }

                    this.products.forEach(p => listContainer.appendChild(this.createProductListItem(p)));
                    lucide.createIcons();
                } catch (error) { 
                    this.showNotification(`Error al cargar productos: ${error.message}`, 'error'); 
                    console.error("Detalle del error al cargar productos:", error);
                }
            },
            
            createProductListItem(product) {
                const li = document.createElement('li');
                li.className = `p-4 border rounded-md hover:bg-gray-50 ${!product.enabled ? 'opacity-50 bg-gray-100' : ''}`;
                li.dataset.productId = product.id;

                const statusColors = {
                    'activo': 'bg-green-100 text-green-800',
                    'inactivo': 'bg-gray-200 text-gray-800',
                    'agotado': 'bg-yellow-100 text-yellow-800'
                };
                const statusBadge = `<span class="px-2 py-1 text-xs font-medium rounded-full ${statusColors[product.status] || 'bg-gray-100'}">${product.status}</span>`;
                
                const imageUrl = product.images && product.images[0]
                    ? (product.images[0].startsWith('http') ? product.images[0] : `${this.apiBaseUrl}/uploads/${product.images[0]}`)
                    : 'https://placehold.co/100x100';

                li.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4 min-w-0">
                            <img src="${imageUrl}" alt="${product.name}" class="w-16 h-16 object-cover rounded-md flex-shrink-0">
                            <div class="min-w-0">
                                <p class="font-bold text-gray-800 truncate">${product.name}</p>
                                <p class="text-sm text-gray-600 font-bold text-pink-600">$${(product.final_price || product.base_price || 0).toFixed(2)}</p>
                                <div class="flex items-center gap-2 mt-1">
                                    ${statusBadge}
                                    <span class="text-xs text-gray-500">Stock: <span class="font-bold stock-display">${product.stock}</span></span>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-2 flex-shrink-0">
                            <button aria-label="Editar" class="p-2 text-blue-600 hover:bg-blue-100 rounded-full edit-btn"><i data-lucide="pencil"></i></button>
                            <button aria-label="Eliminar" class="p-2 text-red-600 hover:bg-red-100 rounded-full delete-btn"><i data-lucide="trash-2"></i></button>
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-t flex items-center gap-2">
                        <input type="number" class="w-24 p-1 border rounded-md text-sm stock-change-input" placeholder="Ej: 10 o -5" aria-label="Cantidad a agregar o quitar">
                        <button class="px-3 py-1 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-sm update-stock-btn">Actualizar Stock</button>
                    </div>`;
                return li;
            },

            handleProductListClick(event) {
                const button = event.target.closest('button');
                if (!button) return;

                const li = button.closest('li');
                const productId = li.dataset.productId;

                if (button.classList.contains('edit-btn')) {
                    this.editProduct(productId);
                } else if (button.classList.contains('delete-btn')) {
                    this.deleteProduct(productId);
                } else if (button.classList.contains('update-stock-btn')) {
                    this.handleStockUpdate(productId, li);
                }
            },

            async handleStockUpdate(productId, listItemElement) {
                const input = listItemElement.querySelector('.stock-change-input');
                const changeAmount = parseInt(input.value, 10);

                if (isNaN(changeAmount)) {
                    this.showNotification('Por favor, introduce un número válido (ej: 10 o -5).', 'error');
                    return;
                }

                try {
                    const response = await fetch(`${this.apiBaseUrl}/api/products/${productId}/stock`, {
                        method: 'PATCH',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-admin-secret': 'tu-clave-secreta-aqui'
                        },
                        body: JSON.stringify({ change: changeAmount })
                    });

                    const result = await response.json();
                    if (!response.ok) throw new Error(result.error || 'Error del servidor');

                    this.showNotification('Stock actualizado con éxito.', 'success');
                    
                    const stockDisplay = listItemElement.querySelector('.stock-display');
                    stockDisplay.textContent = result.newStock;
                    input.value = ''; 

                    const product = this.products.find(p => p.id == productId);
                    if (product) product.stock = result.newStock;

                } catch (error) {
                    this.showNotification(`Error al actualizar stock: ${error.message}`, 'error');
                }
            },

            async handleFormSubmit(event) {
                event.preventDefault();
                const id = document.getElementById('productId').value;
                const headers = { 'x-admin-secret': 'tu-clave-secreta-aqui' };

                let uploadedFilenames = document.getElementById('image-urls').value.split(',').filter(Boolean);

                if (this.imagesToUpload.length > 0) {
                    const formData = new FormData();
                    this.imagesToUpload.forEach(fileObj => formData.append('images', fileObj.file));
                    try {
                        const uploadRes = await fetch(`${this.apiBaseUrl}/api/upload`, { method: 'POST', headers, body: formData });
                        if (!uploadRes.ok) {
                             const errorData = await uploadRes.json();
                             throw new Error(errorData.error || 'Error subiendo imágenes.');
                        }
                        const uploadData = await uploadRes.json();
                        uploadedFilenames = [...uploadedFilenames, ...uploadData.filenames];
                    } catch (error) {
                        this.showNotification(`Error de red al subir imágenes: ${error.message}`, 'error');
                        return;
                    }
                }

                const productData = {
                    name: document.getElementById('name').value,
                    short_description: document.getElementById('short_description').value,
                    long_description: document.getElementById('long_description').value,
                    images: uploadedFilenames,
                    video_url: document.getElementById('video_url').value,
                    category: document.getElementById('category').value.split(',').map(c => c.trim()).filter(Boolean),
                    status: document.getElementById('status').value,
                    enabled: document.getElementById('enabled').checked,
                    stock: parseInt(document.getElementById('stock').value) || 0,
                    base_price: parseFloat(document.getElementById('base_price').value) || 0,
                    sale_price: document.getElementById('sale_price').value ? parseFloat(document.getElementById('sale_price').value) : null,
                    cost_price: document.getElementById('cost_price').value ? parseFloat(document.getElementById('cost_price').value) : null,
                    taxes: parseFloat(document.getElementById('taxes').value) || 0,
                    currency: 'ARS',
                    min_purchase_quantity: parseInt(document.getElementById('min_purchase_quantity').value) || 1,
                    max_purchase_quantity: document.getElementById('max_purchase_quantity').value ? parseInt(document.getElementById('max_purchase_quantity').value) : null,
                    weight: document.getElementById('weight').value ? parseFloat(document.getElementById('weight').value) : null,
                    dimensions: document.getElementById('dimensions').value,
                    customizable: document.getElementById('customizable').checked,
                    has_production_time: document.getElementById('has_production_time').checked,
                    production_time_hours: document.getElementById('has_production_time').checked ? (document.getElementById('production_time_hours').value ? parseInt(document.getElementById('production_time_hours').value) : null) : null,
                    restock_time: document.getElementById('restock_time').value ? parseInt(document.getElementById('restock_time').value) : null,
                    featured: document.getElementById('featured').checked,
                    discount_percentage: parseFloat(document.getElementById('discount_percentage').value.replace('%','')) || null,
                    final_price: parseFloat(document.getElementById('final_price').value.replace('$','')) || 0,
                };
                
                const url = id ? `${this.apiBaseUrl}/api/products/${id}` : `${this.apiBaseUrl}/api/products`;
                const method = id ? 'PUT' : 'POST';

                try {
                    const res = await fetch(url, { 
                        method, 
                        headers: { ...headers, 'Content-Type': 'application/json' }, 
                        body: JSON.stringify(productData) 
                    });
                    if (!res.ok) {
                        const errorData = await res.json(); 
                        throw new Error(errorData.error || `Error del servidor: ${res.status}`);
                    }
                    this.showNotification(`Producto ${id ? 'actualizado' : 'creado'} con éxito.`, 'success');
                    this.resetForm(); 
                    await this.loadProducts();
                } catch (error) { 
                    this.showNotification(`No se pudo guardar: ${error.message}`, 'error'); 
                    console.error("Detalle del error al guardar:", error);
                }
            },

            handleImagePreview(event) {
                const previewContainer = document.getElementById('image-preview');
                for (const file of event.target.files) {
                    const fileId = Date.now() + Math.random();
                    this.imagesToUpload.push({ id: fileId, file: file });
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const div = document.createElement('div');
                        div.className = 'image-preview-item w-20 h-20';
                        div.dataset.fileId = fileId;
                        div.innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover rounded-md"><button type="button" class="remove-btn">&times;</button>`;
                        previewContainer.appendChild(div);
                        div.querySelector('.remove-btn').addEventListener('click', () => {
                            this.imagesToUpload = this.imagesToUpload.filter(f => f.id !== fileId);
                            div.remove();
                        });
                    };
                    reader.readAsDataURL(file);
                }
            },

            editProduct(id) {
                const product = this.products.find(p => p.id == id);
                if (!product) return;
                
                this.resetForm();
                document.getElementById('form-title').innerText = 'Editando Producto';
                document.getElementById('productId').value = product.id;
                
                Object.keys(product).forEach(key => {
                    const el = document.getElementById(key);
                    if (el) {
                        if (el.type === 'checkbox') {
                            el.checked = !!product[key];
                        } else if(key === 'category') {
                            el.value = product[key] ? product[key].join(', ') : '';
                        } 
                        else {
                            el.value = product[key] == null ? '' : product[key];
                        }
                    }
                });
                
                document.getElementById('has_production_time').dispatchEvent(new Event('change'));
                this.updateCalculatedPrices();

                document.getElementById('image-urls').value = product.images ? product.images.join(',') : '';
                const previewContainer = document.getElementById('image-preview');
                if(product.images) {
                    product.images.forEach(imageUrl => {
                        const div = document.createElement('div');
                        div.className = 'image-preview-item w-20 h-20';
                        const fullUrl = imageUrl.startsWith('http') ? imageUrl : `${this.apiBaseUrl}/uploads/${imageUrl}`;
                        div.innerHTML = `<img src="${fullUrl}" class="w-full h-full object-cover rounded-md"><button type="button" class="remove-btn">&times;</button>`;
                        previewContainer.appendChild(div);
                        div.querySelector('.remove-btn').addEventListener('click', () => {
                            const urls = document.getElementById('image-urls').value.split(',');
                            document.getElementById('image-urls').value = urls.filter(u => u !== imageUrl).join(',');
                            div.remove();
                        });
                    });
                }
                window.scrollTo(0, 0);
            },
            
            async deleteProduct(id) {
                if (!confirm('¿Estás seguro? Se eliminará el producto permanentemente.')) return;
                try {
                    const res = await fetch(`${this.apiBaseUrl}/api/products/${id}`, { method: 'DELETE', headers: { 'x-admin-secret': 'tu-clave-secreta-aqui' } });
                    if (!res.ok) {
                        const errorData = await res.json();
                        throw new Error(errorData.error || 'Error del servidor.');
                    }
                    this.showNotification('Producto eliminado.', 'success');
                    await this.loadProducts();
                } catch (error) { this.showNotification(`No se pudo eliminar: ${error.message}`, 'error'); }
            },
            
            resetForm() {
                document.getElementById('product-form').reset();
                document.getElementById('form-title').innerText = 'Añadir Nuevo Producto';
                document.getElementById('productId').value = '';
                document.getElementById('image-preview').innerHTML = '';
                document.getElementById('image-urls').value = '';
                this.imagesToUpload = [];
                document.getElementById('taxes').value = '21';
                this.updateCalculatedPrices();
                document.getElementById('has_production_time').dispatchEvent(new Event('change'));
            },

            showNotification(message, type = 'success') {
                const container = document.getElementById('notification-container');
                const notification = document.createElement('div');
                notification.className = `notification transform translate-x-full ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white py-2 px-4 rounded-md shadow-lg mb-2`;
                notification.textContent = message;
                container.appendChild(notification);
                setTimeout(() => notification.classList.remove('translate-x-full'), 10);
                setTimeout(() => {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => notification.remove(), 4000);
                }, 3000);
            },
            
            updateCalculatedPrices() {
                const basePrice = parseFloat(document.getElementById('base_price').value) || 0;
                const salePrice = parseFloat(document.getElementById('sale_price').value) || 0;
                const taxes = parseFloat(document.getElementById('taxes').value) || 0;

                let discount = 0;
                if (basePrice > 0 && salePrice > 0 && salePrice < basePrice) {
                    discount = ((basePrice - salePrice) / basePrice) * 100;
                }
                document.getElementById('discount_percentage').value = discount > 0 ? `${discount.toFixed(2)}%` : '0%';

                const priceToCalculate = salePrice > 0 && salePrice < basePrice ? salePrice : basePrice;
                const finalPrice = priceToCalculate * (1 + taxes / 100);
                document.getElementById('final_price').value = `$${finalPrice.toFixed(2)}`;
            }
        };

        document.addEventListener('DOMContentLoaded', () => adminApp.init());
    </script>
</body>
</html>

